import React, {useState, useEffect} from 'react'
import classNames from 'classnames'

import useFetch from 'hooks/useFetch'

const AddToFavorites = ({isFavorited, favoritesCount, articleSlug}) => {
    
    const [{response}, doFetch] = useFetch(`/articles/${articleSlug}/favorite`)
    // const newCount = response ? response.article.favoritesCount : favoritesCount
    const [newCount, setNewCount] = useState(favoritesCount);
    const [newIsFavorited, setNewIsFavorited] = useState(isFavorited);

    // const responseCount = response ? response.article.favoritesCount : favoritesCount;
    // const responseIsFavorite = response ? response.article.favorited : isFavorited;
    
    const btnStyles = classNames({
        'btn btn-sm' : true,
        'btn-primary' : newIsFavorited,
        'btn-outline-primary' : !newIsFavorited
    })

    useEffect(() => {
        if(!response) return

        setNewCount(response.article.favoritesCount)
        setNewIsFavorited(response.article.favorited)
    }, [response]);

    const handleLike = (e) => {
        e.preventDefault();

        doFetch({
            method: newIsFavorited ? 'delete' : 'post'

        })
    }

    return (
        <div>
            <button className={btnStyles} onClick={handleLike}>
                <i className="ion-heart"></i>
                <span>&nbsp;{newCount}</span>
            </button>
        </div>
    )
}

export default AddToFavorites
